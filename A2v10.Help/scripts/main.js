(function() { 
/*GENERATED*/
const content = {
  "items": [
    {
      "title": "A2:SDK",
      "url": "/index",
      "items": [
        {
          "title": "Что нового",
          "url": "/whatsnew/index",
          "items": [
            {
              "title": "Февраль 2018",
              "url": "/whatsnew/w201802"
            }
          ]
        }
      ]
    },
    {
      "title": "Модели",
      "url": "/models/index",
      "items": [
        {
          "title": "Модели данных",
          "url": "/models/datamodels"
        },
        {
          "title": "model.json",
          "url": "/models/modelfile"
        }
      ]
    },
    {
      "title": "Представления",
      "url": "/views/index",
      "items": [
        {
          "title": "Xaml",
          "url": "/views/xaml/index",
          "items": [
            {
              "title": "Элементы управления",
              "url": "/views/xaml/controls/index",
              "items": [
                {
                  "title": "Button",
                  "url": "/views/xaml/controls/button"
                },
                {
                  "title": "Selector",
                  "url": "/views/xaml/controls/selector"
                }
              ]
            },
            {
              "title": "Контейнеры",
              "url": "/views/xaml/containers/index",
              "items": [
                {
                  "title": "Block",
                  "url": "/views/xaml/containers/block"
                },
                {
                  "title": "Splitter",
                  "url": "/views/xaml/containers/splitter"
                },
                {
                  "title": "StackPanel",
                  "url": "/views/xaml/containers/stackpanel"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "title": "Шаблоны",
      "url": "/template/index",
      "items": [
        {
          "title": "Свойства",
          "url": "/template/properties"
        },
        {
          "title": "События",
          "url": "/template/events"
        },
        {
          "title": "Команды",
          "url": "/template/commands"
        },
        {
          "title": "Валидаторы",
          "url": "/template/validators"
        }
      ]
    }
  ]
}
;
const files = [{"url":"/index","title":"Платформа А2"},{"url":"/models/datamodels","title":"Модели данных"},{"url":"/models/index","title":"Модели"},{"url":"/models/modelfile","title":"Файл model.json"},{"url":"/template/commands","title":"Шаблоны. Команды"},{"url":"/template/events","title":"Шаблоны. События"},{"url":"/template/index","title":"Шаблоны"},{"url":"/template/properties","title":"Шаблоны. Свойства"},{"url":"/template/validators","title":"Шаблоны. Валидаторы"},{"url":"/views/index","title":"Представления"},{"url":"/views/xaml/index","title":"Представления Xaml"},{"url":"/views/xaml/containers/block","title":"Xaml.Block"},{"url":"/views/xaml/containers/index","title":"XAML. Контейнеры"},{"url":"/views/xaml/containers/splitter","title":"Xaml.Splitter"},{"url":"/views/xaml/containers/stackpanel","title":"Xaml.StackPanel"},{"url":"/views/xaml/controls/button","title":"Xaml.Button"},{"url":"/views/xaml/controls/index","title":"XAML. Элементы управления"},{"url":"/views/xaml/controls/selector","title":"Xaml.Selector"},{"url":"/whatsnew/index","title":"Что нового"},{"url":"/whatsnew/w201802","title":"Что нового. Февраль 2018"}];
const index = {"Модели данных":[1],"Модели":[2],"model.json":[3],"commands":[4],"Команды":[4],"events":[5],"События":[5],"template":[6],"Шаблон":[6],"properties":[7],"Свойства":[7],"validators":[8],"Валидаторы":[8],"Block":[11],"Контейнеры":[12],"Splitter":[13],"StackPanel":[14],"Button":[15],"Controls":[16],"Элементы управления":[16],"Selector":[17],"Что нового":[18,19]};
const fts = {"платформа":[0],"а2":[0,18],"версия":[0],"10":[0,18],"модели":[1,2,19],"данных":[1,16,19],"файл":[3],"model.json":[3],"шаблоны":[4,5,6,7,8],"команды":[4],"события":[5],"свойства":[7,11,13,14],"валидаторы":[8],"представления":[9,10],"xaml":[10,19],"элемент":[11,13,14,15,17,19],"block":[11,12],"все":[11,13,14,15,17,19],"контейнеры":[11,12,13,14],"представляет":[11,13,14],"собой":[11,13,14],"контейнер":[11,13,14],"содержит":[11],"другие":[11],"элементы":[11,12,14,15,16,17],"управления":[11,15,16,17],"контейнерные":[12],"просто":[12],"используются":[12,16],"размещения":[12],"внутри":[12],"себя":[12],"других":[12],"элементов":[12],"-":[12,16,19],"блок":[12],"splitter":[12,13],"разделитель":[12],"stackpanel":[12,14],"панель":[12],"содержащий":[13],"две":[13],"панели":[13,19],"изменяемыми":[13],"размерами":[13],"присоединенные":[13],"котором":[14],"дочерние":[14],"выравниваются":[14],"одну":[14],"линию":[14],"ориентированную":[14],"вертикально":[14],"горизонтально":[14],"button":[15,16],"controls":[16],"ввода":[16],"изменения":[16,18],"отображения":[16],"кнопка":[16],"selector":[16,17],"селектор":[16],"нового":[18],"платформе":[18],"этом":[18],"разделе":[18],"описываются":[18],"последние":[18],"дополнения":[18],"программах":[18],"платформы":[18],"версии":[18,19],"текущий":[18],"номер":[18],"отображается":[18],"правом":[18],"нижнем":[18],"углу":[18],"окна":[18],"браузера":[18],"выпуск":[18,19],"1":[18,19],"февраль":[18,19],"2018":[18,19],"7109-7110":[19],"выпуски":[19],"|":[19],"«":[19],"предыдущий":[19],"следующий":[19],"»":[19],"общие":[19],"исправлена":[19],"ошибка":[19],"из-за":[19],"которой":[19],"нельзя":[19],"было":[19],"очистить":[19],"фильтр":[19],"перезагрузки":[19],"страницы":[19],"правой":[19],"нижней":[19],"объекта":[19],"<splitter>":[19],"теперь":[19],"можно":[19],"задавать":[19],"минимально":[19],"допустимую":[19],"ширину":[19],"\"только":[19],"чтение\"":[19],"запрещался":[19],"<selector>":[19]};
window.app = {content: content, files: files, index: index, fts: fts};
})();
// Copyright © 2017-2018 Alex Kukhtin. All rights reserved.

(function () {

	function doNavigate(event) {
		event.preventDefault();
		let route = this.getAttribute('data-route');
		window.vm.$emit('navigate', route);
	}

	function setHrefs(body) {
		let a = body.querySelectorAll('a');
		a.forEach(function (an) {
			let href = an.getAttribute('href');
			if (href.startsWith('http')) return; // external link
			an.setAttribute('href', '');
			an.setAttribute('data-route', href);
			an.addEventListener('click', doNavigate);
		});
	}

	function loadHtml(url) {
		return new Promise(function (resolve, reject) {
			let xhr = new XMLHttpRequest();
            xhr.onload = function () {
                if (xhr.responseText.startsWith('<!DOCTYPE')) {
                    let body = document.createElement("body");
                    let elem = document.createElement("div");
                    body.appendChild(elem);
                    elem.innerText = 'Not found';
                    resolve(body);
                }
                else {
                    let prs = new DOMParser();
                    let doc = prs.parseFromString(xhr.responseText, 'text/html');
                    let body = doc.body;
                    setHrefs(body);
                    resolve(body);
                }
			};
			xhr.open('GET', url, true);
			xhr.send();
		});
	}

	Vue.component('a2-include', {
		template: '<div class="content-view"></div>',
		props: {
			source: String
		},
		watch: {
			source: function (newSource, oldSource) {
				this.navigateTo(newSource);
			}
		},
		methods: {
			navigateTo(url) {
				let me = this;
				if (url === '/')
					url += 'index';
				//console.warn(url);
				loadHtml('/html' + url + '.html').then(function (elem) {
					me.$el.innerHTML = '';
					let div = document.createElement('div');
					let ch = elem.children;
                    let cha = [];
                    // for..of does not not for HtmlCollection in EDGE
                    let esrc = elem.children;
                    for (let i = 0; i < esrc.length; i++) {
						cha.push(esrc[i]);
					}
					for (ch of cha)
                        me.$el.appendChild(ch);
				});
			}
		}
	});

})();
// Copyright © 2017-2018 Alex Kukhtin. All rights reserved.

(function () {



    const treeItemComponent = {
        name: 'tree-item',
        template: `
<li :title="item.title" @click.stop.prevent="doClick(item)"
    :class="{expanded: isExpanded, collapsed:isCollapsed, active:isActive(item)}" >
    <div class="overlay">
        <a class="toggle" v-if="isFolder" href @click.stop.prevent="toggle"></a>
        <span v-else class="toggle"/>
        <i :class="iconClass"/>
        <a :href="dataHref" tabindex="-1" v-text="item.title"/>
    </div>
    <ul v-if="isFolder" v-show="isExpanded">
        <tree-item v-for="(itm, index) in item.items"
            :key="index" :item="itm" :click="click" :get-href="getHref" :is-active="isActive" :expand="expand" :root-items="rootItems"/>
    </ul>   
</li>
`,
        props: {
            item: Object,
            options: Object,
            rootItems: Array,
            /* callbacks */
            click: Function,
            expand: Function,
            isActive: Function,
            getHref: Function
        },
        methods: {
            doClick(item) {
                this.click(item);
            },
            toggle() {
                if (!this.isFolder)
                    return;
                Vue.set(this.item, "open" , !this.item.open);
            }
        },
        computed: {
            isFolder: function () {
                let ch = this.item.items;
                return ch && ch.length;
            },
            isExpanded: function () {
                return this.isFolder && this.item.open;
            },
            isCollapsed: function () {
                return this.isFolder && !this.item.open;
            },
            iconClass: function () {
                return "ico ico-" + (this.isFolder ? "node" : "leaf");
            },
            dataHref() {
                return this.getHref ? this.getHref(this.item) : '';
            }
        }
    };


    Vue.component('tree-view', {
        components: {
            'tree-item': treeItemComponent
        },
        template: `
<ul class="tree-view">
    <tree-item v-for="(itm, index) in items" :options="options" :get-href="getHref"
        :item="itm" :key="index"
        :click="click" :is-active="isActive" :expand="expand" :root-items="items">
    </tree-item>
</ul>
        `,
        props: {
            options: Object,
            items: Array,
            isActive: Function,
            click: Function,
            expand: Function,
            getHref: Function
        },
        computed: {
        },
        methods: {
        },
        created() {
        },
        updated() {
        }
    });

	Vue.component('a2-content-view', {
		template: '<div class="sub-side"><tree-view ref="treeView" :items="root.items" :click="navigate" :is-active="isActive" :get-href="getHRef"></tree-view></div>',
		data() {
			return {
				root: window.app.content
			};
        },
        computed: {
            currentUrl() {
                return window.location.pathname;
            }
        },
        methods: {
            navigate(item) {
                var vm = window.vm;
                vm.$emit('navigate', item.url);
                this.findActive(item.url);
            },
            isActive(item) {
                return item.active;
            },
            getHRef(item) {
                return item.url;
            },
            findActive(url) {

                function findOne(item) {
                    let active = item.url.toLowerCase() === url.toLowerCase();
                    Vue.set(item, 'active', active);
                    if (!item.items) return;
                    item.items.forEach(findOne);
                    if (item.items.some((itm) => itm.active || itm.open))
                        Vue.set(item, 'open', true);
                }

                this.root.items.forEach(findOne);
            }
        },
        mounted() {
            const vm = window.vm;
            vm.$on('navigated', (url) => {
                //console.warn('navigated:' + url);
                this.findActive(url);
            })
        }
	});
})();
// Copyright © 2017-2018 Alex Kukhtin. All rights reserved.

(function () {



	Vue.component('a2-index-view', {
		template: `
<div class="sub-side">
    <div class="index-view">
        <div class="search-block">
            <label>Введите ключевое слово для поиска:</label>
            <input class="input-search" type=text v-model="fragment"></input>
        </div>
	    <ul class="index-tree">
		    <li v-for="(val, valIndex) in list">
                <a :class="{'active': isActive(val)}" v-if="val.files.length === 1" v-text="val.word" @click.stop.prevent="navigate(val, 0)"></a>
                <div v-else>
                    <span class="word-folder" v-text="val.word"></span>
                    <ul>
                        <li class="file-link" v-for="(itm, itmIndex) in val.files">
                            <a :class="{active: isActive(itm)}" v-text="itm.title" @click.stop.prevent="navigateFile(itm)"></a>
                        </li>
                    </ul>
                </div>
            </li>
	    </ul>
    </div>
</div>`,
/*
    <pre>list: {{active}}</pre>
	<pre v-once>{{root}}</pre><pre v-once>{{files}}</pre>
*/
		data() {
			return {
				root: window.app.index,
                files: window.app.files,
                active: null,
                fragment: '',
			};
        },
        computed: {
            list() {
                const f = this.fragment.toLowerCase();
                const root = this.root;
                const files = this.files;
                return Object.keys(this.root)
                    .filter(val => !f || val.toLowerCase().indexOf(f) !== -1)
                    .map(v => { return { word: v, files: root[v].map(f => files[f]) }; });
            }
        },
        methods: {
            isActive(itm) {
                return itm === this.active;
            },
			navigate(itm, ix) {
                var vm = window.vm;
                this.active = itm;
				vm.$emit('navigate', itm.files[ix].url);
			},
			navigateFile(itm) {
                var vm = window.vm;
                this.active = itm;
                vm.$emit('navigate', itm.url);
            }
        },
        mounted() {
        }
	});
})();
// Copyright © 2017-2018 Alex Kukhtin. All rights reserved.

(function () {

// {{key}} : {{res}} : {{res.length}}


	Vue.component('a2-search-view', {
		template: 
`<div class="sub-side">
    <div class="index-view">
	    <div class="search-block">
            <label>Введите слово для поиска:</label>
		    <input class="input-search" v-model.lazy="searchText">
	    </div>
	    <ul class="index-tree">
		    <li @click.prevent="navigate(res[0], key)" v-for="(res, key) in searchResult">
                <a v-text="key" v-if="res.length == 1" 
                    :class="{active: isActive(0, key)}" 
                    @click.stop.prevent="navigate(0, key)"></a>
                <div v-else>
                    <span class="word-folder" v-text="key"></span>
                    <ul>
                        <li class="file-link" v-for="(ix) in res">
                            <a v-text="file(ix)" 
                                :class="{active: isActive(ix, key)}" 
                                @click.stop.prevent="navigate(ix, key)"></a>
                        </li>
                    </ul>
                </div>
            </li>
	    </ul>
    </div>
</div>`,
		data() {
			return {
                searchText: '',
                activeKey: '',
                activeIndex: 0
			};
		},
		watch: {
			searchText(newVal) {
			}
		},
		computed: {
            searchResult() {
                let fts = window.app.fts;
                let r = {};
                if (!this.searchText) return r;
                for (let key in fts) {
                    if (key.indexOf(this.searchText) !== -1)
                        r[key] = fts[key];
                }
				return r;
			}
		},
        methods: {
            file(ix) {
                let file = window.app.files[ix]
                return file ? file.title : '#ERR';
            },
            isActive(ix, key) {
                return ix === this.activeIndex && key === this.activeKey;
            },
			navigate(ix, key) {
                var vm = window.vm;
                this.activeKey = key;
                this.activeIndex = ix;
				vm.$emit('navigateFile', ix);
			}
		}
	});
})();
// Copyright © 2017-2018 Alex Kukhtin. All rights reserved.

(function () {

	function makeUrl(url) {
		if (url.startsWith('/'))
			return url; // root-based
		let cUrl = window.location.pathname.split('/').filter(x => !!x);
		cUrl.splice(cUrl.length - 1, 1);
		let nUrl = url.split('/').filter(x => !!x);
		let xUrl = [];
		nUrl.forEach(x => {
			if (x === '..')
				cUrl.splice(cUrl.length - 1, 1);
			else
				xUrl.push(x);
		});
		let newUrl = cUrl.concat(xUrl);
		return '/' + newUrl.join('/');
	}

	const vm = new Vue({
		el: '#app',
		data: {
			content: '',
			activeTab: 'content'
		},
		methods: {
			navigate(url) {
                url = makeUrl(url);
                if (this.content === url)
                    return;
				window.history.pushState(null, null, url);
                this.content = url;
                this.$emit('navigated', this.content);
			},
			tab(name) {
				this.activeTab = name;
			},
			isActive(name) {
				return name === this.activeTab;
			}
		},
		created() {
			let me = this;
            window.vm = this;
			window.addEventListener('popstate', function () {
                me.content = window.location.pathname;
                me.$emit('navigated', me.content);
			}, false);

			this.$on('navigate', function (url) {
				me.navigate(url);
			});

            this.$on('navigateFile', function (index) {
				let files = window.app.files;
				let file = files[index];
				me.navigate(file.url);
			});
		},
		mounted() {
			let url = window.location.pathname;
			if (url === '/')
				url = '/index';
			this.navigate(url);
		}
    });
})();